import csv
import json

# Маппинг имен судей из CSV в id из HTML
judge_name_to_id = {
    "Тима Сусляев": 70,
    "Ai Accordions": 71,
    "Надежда Капустина": 7,
    "Оксана Лащилина": 14,
    "Артур Колесник": 23,
    "Макс Громов": 72,
    " Отряд Котовскага": 2,  # Константин Бондаренко
    "Алексей Алмавем": 13,
    "iva Muzhskoi": 39,
    "Виталий Мартюков": 73,
    "Алексей Леонтьев": 20,
    "Яан Лодди": 25,
    "Елена Слободчикова ": 54,
    "Илья Дорожкин": 11,
    "Александр Сулимов": 38,
    "Андрей Салов": 57,
    "Евгений Мазаков": 74,
    "Денис Смирнов": 59,
    "Константин Бондаренко (b'n'd)": 68,
    "Руслан Назарович": 63,
    "Татьяна Руденко": 9,
    "Максим Дубровский": 75,
    "Neldy Music": 6,
    "Ze Gamer": 4,
    "Наталия Фомина": 76,
    "Бред Питт": 28,
    "Анна Чулкова": 18,
    "Михаил Юршевич": 77,
    "Ольга Гавришина": 22,
    "Маруся Хмельная": 78,
    "Михаил Дмитриев": 24,
    "Арон Авесин": 65,
    "Ai Sound Architect Digital Composer": 29,
    "Николай Петров": 58,
    "Аиболид Творческое Объединение": 79,
    "Ивита Полонская": 3,
    "Павел Желибо": 5,
    "Папа Сэм": 43,
    "Валерий Востриков": 64,
    "Granny Dances": 50,
    "Максим Яшин": 21,
    "Hito Shniperson": 19,
    "Екатерина Евстратова": 10,
    "Евгений Александрович": 17,
    "Sashka Rheanomalia": 15,
    "Кирилл Панов": 80,
    "Николай Баркалов": 81,
    "Sergey Chayka": 31,
    "Skart Ai Project": 32,
    "Владимир Морозов": 56,
    "Михаил Зиновьев": 34,
    "Дмитрий Люсков": 36,
    "Амалия Жучок": 41,
    "Наталья Дьякова": 35,
    "Андрей Воронин": 42,
    "Ирина Воскобойникова": 37,
    "Kazladur Brink": 8
}

# Маппинг id песен из CSV в id из HTML
song_id_to_participant_id = {
    "70": 16,  # Это Финал - Сережа Грякалов
    "71": 5,   # Палач - Павел Желибо
    "7": 1,    # На дороге иной - Cол Иодим
    "14": 67,  # I Won't Say Goodbye - Юрий Петухов
    "23": 6,   # Сколько лет — сколько зим… - Neldy Music
    "72": 14,  # Сашка-гармонист - Оксана Лащилина
    "2": 52,   # Бабки любят бабки - Дмитрий Выхин
    "13": 12,  # Мы-снова чемпионы - Dj Neophron
    "39": 13,  # Птицы в небе - Алексей Алмавем
    "73": 18,  # Алиса, посоветуй! - Анна Чулкова
    "20": 57,  # Интернет - Андрей Салов
    "25": 19,  # Сделай это со мной - Hito Shniperson
    "54": 27,  # Гречка - наше всё - Павел Гупало
    "11": 21,  # Enough - Максим Яшин
    "38": 46,  # Лонгин Сотник - Сова Сумрачная
    "57": 33,  # Неоновые Сны - Кирилл Генкин
    "74": 9,   # Лети - Татьяна Руденко
    "59": 37,  # Сердце моё в огне - Ирина Воскобойникова
    "68": 47,  # Румба Шредингера - Yulisse Cobre
    "63": 7,   # Цвет ночи - Надежда Капустина
    "9": 35,   # Чезабретта - Наталья Дьякова
    "75": 8,   # Notice.me - Kazladur Brink
    "6": 38,   # Солнце скрылось - Александр Сулимов
    "4": 36,   # Индия - Дмитрий Люсков
    "76": 22,  # Ураган - Ольга Гавришина
    "28": 40,  # Актриса спускается в партер - Константин Леонов-Шуанский
    "18": 60,  # Азовское море зовёт - Сергей Миньков
    "77": 45,  # Инклюз - Юн-Софус Кумле
    "54": 54,  # Если ты уйдешь - Елена Слободчикова
    "78": 2,   # Плюшевые поэты - Константин Бондаренко
    "24": 23,  # Свет дозволенных Рифм - Артур Колесник
    "65": 48,  # Слёзы сбереги - Marty Macflay
    "29": 69,  # Июньский день - Михаил Жаров
    "4": 4,    # На дорогах лесных - Ze Gamer
    "79": 30,  # Нарисованный мальчишка - Николай Постернак
    "3": 25,   # Distortion of Memory - Яан Лодди
    "5": 59,   # 40 лет - Денис Смирнов
    "43": 3,   # Devil made me do it - Ивита Полонская
    "64": 20,  # Чужое Солнце - Алексей Леонтьев
    "50": 63,  # Иди - Руслан Назарович
    "21": 66,  # be-the-light - Sky Vashuk
    "19": 15,  # Hushwires - Sashka Rheanomalia
    "10": 53,  # Гром неба - Коловрат Коло
    "17": 11,  # После жизни - Илья Дорожкин
    "15": 10,  # Echoes in the Hollow - Екатерина Евстратова
    "80": 41,  # В темноте - Амалия Жучок
    "81": 24,  # Эмодзи - Михаил Дмитриев
    "31": 26,  # Вампир - Юлия Журженко
    "32": 64,  # Миры Хэмингуэя - Валерий Востриков
    "56": 42,  # Разговор с собой - Андрей Воронин
    "34": 43,  # Echo - Папа Сэм
    "36": 44,  # Hold me tight - Дима Cавченко
    "41": 39,  # Toronto Fader - iva Muzhskoi
    "35": 31,  # Возможно - Sergey Chayka
    "42": 28,  # Дебил, но любил - Бред Питт
    "37": 17,  # Serpent's Gift - Евгений Александрович
    "8": 65,   # ЭХ, МАРС, ТВОЮ МАТЬ! - Арон Авесин
    "70": 51,  # Упс! - Станислав Земсков
    "71": 55,  # Relic - Андрей Лабазов
    "7": 50,   # Упала ночь на землю - Granny Dances
    "14": 32,  # Качает вагон - Skart Ai Project
    "23": 68,  # День Х - Константин Бондаренко (b'n'd)
    "72": 29,  # Это вирус - Ai Sound Architect Digital Composer
    "2": 61,   # Если бы - Евгений Абрамов
    "13": 34,  # Тут у моря - Михаил Зиновьев
    "39": 56,  # Жара - Владимир Морозов
    "73": 58,  # Транс Вальс - Николай Петров
    "20": 62,  # Завтра - Роберт Астаповский
    "25": 49   # Ты не ангел мой - Виталий Сазонов
}

def read_voting_data():
    voting_data = {}
    with open('1.csv', 'r', encoding='utf-8') as file:
        reader = csv.reader(file, delimiter=';')
        headers = next(reader)  # Первая строка - заголовки (имена судей)
        
        # Обрабатываем каждую строку (песня)
        for row in reader:
            if len(row) > 1:
                song_name = row[0]  # Название песни
                scores = row[1:]  # Оценки от судей
                
                # Для каждого судьи (по колонкам)
                for i, score in enumerate(scores):
                    if score and score.strip() and score != '':
                        try:
                            judge_name = headers[i] if i < len(headers) else f"Judge_{i}"
                            judge_id = judge_name_to_id.get(judge_name)
                            
                            if judge_id:
                                if judge_id not in voting_data:
                                    voting_data[judge_id] = {}
                                
                                # Используем номер строки как id песни
                                song_id = len(voting_data[judge_id]) + 1
                                voting_data[judge_id][song_id] = float(score.replace(',', '.'))
                        except ValueError:
                            continue
    
    return voting_data

def find_top4_for_judges(voting_data):
    judge_top4 = {}
    
    for judge_id, scores in voting_data.items():
        # Сортируем песни по оценкам (убывание)
        sorted_songs = sorted(scores.items(), key=lambda x: x[1], reverse=True)
        
        # Берем топ-4
        top4 = [song_id for song_id, score in sorted_songs[:4]]
        judge_top4[judge_id] = top4
    
    return judge_top4

def main():
    print("Анализируем данные голосования из 1.csv...")
    
    # Читаем данные голосования
    voting_data = read_voting_data()
    print(f"Найдено {len(voting_data)} судей с оценками")
    
    # Находим топ-4 для каждого судьи
    judge_top4 = find_top4_for_judges(voting_data)
    
    # Выводим результаты
    print("\nТоп-4 для каждого судьи:")
    for judge_id, top4 in judge_top4.items():
        print(f"Судья {judge_id}: {top4}")
    
    # Сохраняем результаты в JSON
    with open('judge_top4_correct.json', 'w', encoding='utf-8') as file:
        json.dump(judge_top4, file, indent=2, ensure_ascii=False)
    
    print(f"\nРезультаты сохранены в judge_top4_correct.json")

if __name__ == "__main__":
    main() 